{% extends 'base/base_usuarios.html' %}
{% load staticfiles %}
{% load widget_tweaks %}

{% block javascript %}
  <link rel="stylesheet" href="{% static 'css/jquery.dataTables.min.css' %}"/>
  <script type="text/javascript" src="{% static 'js/jquery.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/popper.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/bootstrap.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/jquery.dataTables.min.js' %}"></script>
{% endblock %}

{% block botones %}
  <p><li class="dashboard"><a href="{% url 'agentes_a_cargo' %}">Mis agentes</a></li></p>
{% endblock %}

{% block extra %}

  {%if cantidad == 0 %}
    <div class="alert alert-danger" role="alert">
      <div align="center">
        <strong>La persona no contiene liquidaciones</strong>
      </div>
    </div>
  {% endif %}

  {% if filter %}

      <script type="text/javascript">
        jQuery(document).ready(function($) {
          $(".clickable-row").click(function() {
            window.location = $(this).data("href");
           });
         });

       $(document).ready(function () {
         // Setup - add a text input to each footer cell
        $('#miTabla tfoot th').each( function () {
            var title = $(this).text();
            $(this).html( '<input type="text" placeholder="Search '+title+'" />' );
        } );

        // DataTable
        var table = $('#miTabla').DataTable();

        // Apply the search
        table.columns().every( function () {
            var that = this;

            $( 'input', this.footer() ).on( 'keyup change', function () {
                if ( that.search() !== this.value ) {
                    that
                        .search( this.value )
                        .draw();
                }
            } );
        } );
       });
      </script>

        <div id="dive" style="margin-top:100; margin-left:30; margin-right: 20;" class="answer_list" >
          <form method="get" style="background-color:white; text-align:center">
             <div class="well">
                 <div class="row">
                   <div class="form-group col-sm-2 col-md-2" style="margin-left:10">
                     <strong>{{ filter.form.documento.label_tag }} </strong>
                     {% render_field filter.form.documento class="form-control" %}
                   </div>
                   <div class="form-group col-sm-2 col-md-2">
                     <strong>{{ filter.form.nya.label_tag }}</strong>
                     {% render_field filter.form.nya class="form-control" %}
                   </div>
                   <div class="form-group col-sm-2 col-md-2">
                     <strong>{{ filter.form.cuil.label_tag }}</strong>
                     {% render_field filter.form.cuil class="form-control" %}
                   </div>
                   <div style="margin-top:16" class="form-group col-md-4">
                     <strong>SAF:<strong>
                     <select name="saf" style="max-width:90%; font-size: 70%" class="form-control">
                          {% for empresa in lista_empresas %}
                            <option value="{{empresa}}">{{empresa.descrip}} ({{empresa}})</option>
                          {% endfor %}
                     </select>

                   </div>
                   <div style="margin-top:48" class="form-group col-sm-1">

                     <button type="submit" name="boton-buscar" class="btn btn-primary">
                        <span class="glyphicon glyphicon-search"></span> Filtrar
                     </button>
                     </div>
                </div>
              </div>

        <div>
          <table  id="miTabla" class="table table-bordered">
              <thead style="background-color:#cccccc; ">
                <tr>
                  <th>Documento</th>
                  <th>Nombre y Apellido</th>
                  <th>Cuil</th>
                </tr>
              </thead>
              <tfoot>
                <tr>
                  <th>Documento</th>
                  <th>Nombre y Apellido</th>
                  <th>Cuil</th>
               </tr>
              </tfoot>
              <tbody >
                {% for persona in filter.qs %}
                  <tr style="cursor:pointer" class='clickable-row' data-href="{% url 'liquidaciones_agente' documento=persona.documento %}">
                    <td>{{ persona.documento }}</td>
                    <td>{{ persona.nya }}</td>
                    <td>{{ persona.cuil }}</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
            <div class="col-md-12 text-center">
            <ul class="pagination pagination-lg pager" id="myPager"></ul>
        </div>
        </div>

    </div>
{% endif %}

{% endblock %}

{% block barra-filtros %}
	{% if meses %}
  	<div class="contenedor">
				{% for key, values in meses.items %}
		       	<a href="{% url 'liquidaciones_agente' mes=key documento=doc %}"><i class="fa fa-pencil"></i> {{values}}</a>
	 			{% endfor %}
        <a href="{% url 'liquidaciones_agente' documento=doc %}"><i class="fa fa-pencil"></i>TODOS</a>
		</div>
	{% endif %}
{% endblock %}

{% block tabla-liquidaciones %}
	{% if tabla %}
		<div id="centrado-de-tabla">
      <div align="center">
        <strong>{{nombre_persona}}</strong>
      <div>
			{% autoescape off %}{{tabla}}{% endautoescape %}
		</div>
		<div align="center">
			<a href="{% url 'liquidaciones_a_pdf' documento=doc %}"><i class="fa fa-file"></i> Imprimir Liquidaci√≥n</a>
		</div>
	{% endif %}
{% endblock %}
